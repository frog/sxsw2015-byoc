{"version":3,"file":"board.js","sources":["../../../src/client/scripts/board.ts"],"sourcesContent":["var board =\r\n{\r\n\tio: null,\r\n\tplayerTemplate: null\r\n};\r\n\r\nvar gameState =\r\n{\r\n\tWAITING: 0,\r\n\tREADY: 1,\r\n\tSTARTING: 2,\r\n\tRUNNING: 3,\r\n\tCOMPLETED: 4\r\n};\r\n\r\nvar sounds =\r\n[\r\n  new Howl({ src: [\"/sounds/1.mp3\"], volume: 1.0 }),\r\n  new Howl({ src: [\"/sounds/2.mp3\"], volume: 1.0 }),\r\n  new Howl({ src: [\"/sounds/3.mp3\"], volume: 1.0 }),\r\n  new Howl({ src: [\"/sounds/4.mp3\"], volume: 1.0 }),\r\n  new Howl({ src: [\"/sounds/5.mp3\"], volume: 0.25 })\r\n];\r\n\r\nboard.init = function ()\r\n{\t\r\n\tboard.playerTemplate = $(\"#players .template\").clone().toggleClass(\"template\", false);\r\n\t$(\"#players .template\").remove();\r\n\r\n\tboard.io = window.io(\"/board\");\r\n\r\n\tboard.io.on(\"connect\", function () {});\r\n\r\n\tboard.io.on(\"PlayersUpdated\", function (players)\r\n\t{\r\n\t\tvar keys = new Array(Object.keys(players).length);\r\n\t\tfor (var id in players)\r\n\t\t{\r\n\t\t\tkeys[players[id].number - 1] = id;\r\n\t\t}\r\n\t\tfor (var i = 0, ic = keys.length; i < ic; i += 1)\r\n\t\t{\r\n\t\t\tboard.updatePlayer(players[keys[i]]);\r\n\t\t}\r\n\t});\r\n\r\n\tboard.io.on(\"PlayerUpdated\", function (_player)\r\n\t{\r\n\t\tboard.updatePlayer(_player);\r\n\t});\r\n\r\n\tboard.updatePlayer = function (_player)\r\n\t{\r\n\t\tvar player = $(\".player:nth-child(\" + _player.number + \")\");\r\n\r\n\t\tif (player.length == 0)\r\n\t\t{\r\n\t\t\tplayer = board.playerTemplate.clone();\r\n\t\t\tplayer.appendTo(\"#players\");\t\t\t\r\n\t\t\tplayer.find(\".number\").html(_player.number);\r\n\t\t\tplayer.velocity({ translateY: 100 }, { duration: 0 }).velocity({ translateY: 0 }, { duration: 750, easing: \"spring\" });\r\n\t\t}\r\n\t\tplayer.find(\".errors .icon\").each(function (index)\r\n\t\t{\r\n\t\t\t$(this).toggleClass(\"enabled\", (index < _player.errors));\r\n\t\t});\r\n\t\tplayer.find(\".stats\").html(_player.stats.lastSequenceDuration / 1000 + \"s\");\r\n\t\tplayer.find(\".stats\").toggleClass(\"success\", (_player.stats.lastSequenceDuration > 0));\r\n\t\tplayer.toggleClass(\"disabled\", _player.errors == 3);\r\n\t\tplayer.toggleClass(\"disconnected\", !_player.isConnected);\r\n\r\n\t\tvar device = \"html5\";\r\n\t\tvar devices = [\"Windows Phone\", \"Android\", \"iPhone\"];\r\n\t\tfor (var i = 0, ic = devices.length; i < ic; i += 1)\r\n\t\t{\t\r\n\t\t\tif (new RegExp(devices[i]).test(_player.userAgent))\r\n\t\t\t{\r\n\t\t\t\tswitch (devices[i])\r\n\t\t\t\t{\r\n\t\t\t\t\tcase \"Windows Phone\":\r\n\t\t\t\t\t\tdevice = \"windows\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase \"Android\":\r\n\t\t\t\t\t\tdevice = \"android\";\r\n\t\t\t\t\t\tbreak;\t\r\n\t\t\t\t\tcase \"iPhone\":\r\n\t\t\t\t\t\tdevice = \"ios\";\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tdefault:\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tplayer.find(\".device .icon\").find(\"use\").attr(\"xlink:href\", \"#icon-device-\" + device);\r\n\t};\r\n\r\n\tboard.io.on(\"ButtonDown\", function (args) \r\n\t{\r\n\t\tvar button = $(\".player:nth-child(\" + (args.playerNumber) + \") > .buttons > .button:nth-child(\" + args.buttonId + \")\");\r\n\t\tbutton.toggleClass(\"active\", true);\r\n\t\tsetTimeout(function () { button.toggleClass(\"active\", false); }, 100);\r\n\t});\r\n\r\n\tboard.io.on(\"SequenceStarted\", function (game)\r\n\t{\r\n\t\t$(\"#watermark\").toggleClass(\"hidden\", true);\r\n\t\t$(\"#winner\").toggleClass(\"hidden\", true);\r\n\t\t$(\"#sequence\").toggleClass(\"hidden\", false);\r\n\t\t$(\"#sequence .count\").html(game.sequence.length);\r\n\t\t$(\".player\").find(\".stats\").velocity(\"stop\", true).velocity({ opacity: 1 });\r\n\t\tsetTimeout(function ()\r\n\t\t{\r\n\t\t\tvar accel = game.sequence.length;\r\n\t\t\tvar sequenceInterval = setInterval(function ()\r\n\t\t\t{\r\n\t\t\t\tif (game.sequence.length == 0)\r\n\t\t\t\t{\r\n\t\t\t\t\tclearInterval(sequenceInterval);\r\n\t\t\t\t\tsetTimeout(function () \r\n\t\t\t\t\t{ \r\n\t\t\t\t\t\tboard.io.emit(\"RunSequence\");\r\n\t\t\t\t\t\t$(\"#sequence\").toggleClass(\"hidden\", true);\r\n\t\t\t\t\t\t$(\"#countdown\").velocity({ translateX: [0, 0] }).velocity({ translateX: \"-=100%\" }, { duration: game.sequenceDuration - 500, easing: \"linear\" });\r\n\t\t\t\t\t}, 750);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar id = game.sequence.shift();\r\n\t\t\t\tsounds[id - 1].play();\r\n\t\t\t\tvar button = $(\"#sequence .button:nth-child(\" + id + \")\");\r\n\t\t\t\tbutton.toggleClass(\"active\", true);\r\n\t\t\t\tsetTimeout(function () { button.toggleClass(\"active\", false); }, 300 - (accel * 3));\r\n\t\t\t}, 450 - (accel * 6));\r\n\t\t}, 750);\r\n\t});\r\n\r\n\tboard.io.on(\"SequenceCompleted\", function ()\r\n\t{\r\n\t\t$(\"#sequence .count\").html(\"\");\r\n\t\t$(\"#sequence\").toggleClass(\"hidden\", false);\r\n\t\t$(\"#sequence .button\").toggleClass(\"active\", true);\r\n\t\t$(\"#sequence .button\").velocity({ rotateZ: \"360deg\" }).velocity(\"reverse\");\r\n\t\tsounds[4].play();\r\n\t\tsetTimeout(function ()\r\n\t\t{\r\n\t\t\t$(\"#sequence\").toggleClass(\"hidden\", true);\r\n\t\t\t$(\"#sequence .button\").toggleClass(\"active\", false);\r\n\t\t}, 1000);\r\n\t});\r\n\t\r\n\tboard.io.on(\"SequenceWon\", function (playerNumber)\r\n\t{\r\n\t\t$(\".player:nth-child(\" + playerNumber + \")\").find(\".stats\").velocity({ opacity: .2 }, { loop: true });\r\n\t});\r\n\t\r\n\tboard.io.on(\"GameWon\", function (playerNumber)\r\n\t{\r\n\t\t$(\"#winner .number\").html(playerNumber);\r\n\t\t$(\"#winner\").toggleClass(\"hidden\", false);\r\n\t});\r\n\r\n\tboard.io.on(\"GameReset\", function ()\r\n\t{\r\n\t\t$(\"#players\").empty();\r\n\t\t$(\"#watermark\").toggleClass(\"hidden\", false);\r\n\t\t$(\"#winner\").toggleClass(\"hidden\", true);\r\n\t});\r\n};\r\n"],"names":[],"mappings":";;;CAeA,IAAI,MAAM,GACV;KACE,IAAI,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;KACjD,IAAI,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;KACjD,IAAI,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;KACjD,IAAI,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,EAAE,MAAM,EAAE,GAAG,EAAE,CAAC;KACjD,IAAI,IAAI,CAAC,EAAE,GAAG,EAAE,CAAC,eAAe,CAAC,EAAE,MAAM,EAAE,IAAI,EAAE,CAAC;EACnD;;;;"}